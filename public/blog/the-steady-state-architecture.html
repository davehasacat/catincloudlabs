<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Steady State Architecture - CatInCloud Labs</title>

  <meta name="description" content="Handling scale (SPY) and chaos (GME) using boring tools: MWAA, Snowflake, and dbt. Why predictability beats complexity in data engineering." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://catincloudlabs.com/blog/the-steady-state-architecture" />

  <meta property="og:title" content="The Steady State Architecture" />
  <meta property="og:description" content="Why I chose AWS MWAA, Snowflake, and dbt to handle the 'Core & Chaos' portfolio." />
  <meta property="og:image" content="https://catincloudlabs.com/assets/brand/social-card.v2.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <link rel="icon" href="/assets/favicons/favicon.svg" type="image/svg+xml" />
  <link rel="alternate icon" href="/assets/favicons/favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="/assets/favicons/favicon.png" />
  <meta name="theme-color" content="#f3f4f6" />
  <meta name="color-scheme" content="light" />

  <link rel="stylesheet" href="/assets/css/styles.css" />
</head>

<body class="page--blog-post">
  <a href="#main" class="skip-link">Skip to content</a>

  <header class="header">
    <div class="container nav">
      <a class="brand" href="/" aria-label="CatInCloud Labs">
        <img src="/assets/brand/logo-wordmark-light.svg" alt="CatInCloud Labs" height="32" />
      </a>
      <nav class="menu" aria-label="Primary">
        <a href="/">Home</a>
        <a href="/about">About</a>
        <a href="/projects">Projects</a>
        <a href="/services">Services</a>
        <a href="/blog" class="button ghost active" aria-current="page">Blog</a>
        <a href="/contact#contact-form" class="button ghost">Contact</a>
      </nav>
    </div>
  </header>

  <main id="main">
    <section class="hero">
      <div class="container hero-simple">
        <div class="stack stack--hero">
          <div class="kicker">
            <a href="/blog" style="color: inherit; text-decoration: none;">&larr; Engineering Log</a>
          </div>
          <h1 class="title">The Steady State Architecture</h1>
          <p class="subtitle">
            Dec 22, 2025 ¬∑ Architecture
          </p>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <div class="stack stack--section">
          
          <article class="card card--narrow article-body">
            
            <p>I just updated the CatInCloud Labs project page with a massive expansion: The "Core &amp; Chaos" portfolio is live. üòº</p>

            <p>I'm now modeling options chains for the entire Magnificent Seven (NVDA, AAPL, MSFT...), the Macro heavyweights (SPY, QQQ, IWM, TLT), plus the Chaos engines (GME, VIX, IBIT, and RDDT).</p>

            <p>When market data needs to cover the most traded ETFs, the biggest tech giants, and the most volatile meme assets simultaneously, "fragile" data pipelines don't cut it. This brings me back to the core architectural decision for this project: Why choose a "boring" stack like AWS MWAA + Snowflake + dbt?</p>

            <img 
                src="/assets/diagrams/security-observability.v5.svg" 
                alt="Architecture Diagram: AWS MWAA, Snowflake, and dbt" 
                class="article-img"
                loading="lazy"
            >
            
            <h3>The Problem: Scale meets Chaos</h3>

            <p>Market data is a unique engineering challenge because it combines predictable massive volume with unpredictable spikes. SPY churns out millions of rows every day. GME will be dormant for months, then explode with 10x volume in a single afternoon.</p>

            <p>To handle this, I needed an architecture that provided the ultimate engineering luxury: predictability.</p>

            <h3>1. Orchestration: Why AWS MWAA?</h3>
            <p>A simple cron job is too fragile to handle complex dependencies across 15 asset classes. If the raw data for NVDA lands late, I need the transformation layer to wait, not fail silently.</p>
            
            <p>On the other hand, managing a Kubernetes cluster just to run Airflow adds massive operational overhead. I chose Amazon Managed Workflows for Apache Airflow (MWAA) because it decouples infrastructure maintenance from business logic:</p>
            <ul>
                <li><strong>Managed Environment:</strong> AWS handles the scaling of the scheduler and web server. I don't patch servers; I just deploy DAGs.</li>
                <li><strong>Complex Dependencies:</strong> Airflow allows me to define strict sensors and triggers. The pipeline knows exactly what data is required before it attempts a run.</li>
                <li><strong>Security:</strong> It runs entirely inside a private VPC, keeping the control plane isolated from the public internet.</li>
            </ul>

            <h3>2. Compute: Why Snowflake?</h3>
            <p>When you are ingesting full options chains, the row counts get heavy fast. Managing the compute resources for that ingest locally or on an EC2 instance is a constant balancing act between over-provisioning (wasting money) and under-provisioning (crashing pipelines).</p>
            
            <p>Snowflake solves this via the separation of storage and compute. I use a dedicated Virtual Warehouse for ingestion that scales up instantly to chew through the massive SPY/NVDA files, and then immediately spins down. It doesn't matter if GME has 1 record or 1 million records today; Snowflake scales to fit the load without human intervention, and I only pay for the seconds the warehouse is running.</p>

            <h3>3. The Engineering Superpower: Idempotency in Design</h3>
            
            <p>In data engineering, things break. APIs timeout, files arrive corrupted, or business logic changes mid-flight. The difference between a "fragile" pipeline and a "calm" one is what happens <em>after</em> the break.</p>

            <p>In a fragile system, a failure usually requires manual cleanup: "Did step 3 finish? Do I need to delete the partial rows for today? If I re-run this, will I get duplicates?"</p>

            <p>I designed this architecture around <strong>idempotency at the DAG level</strong>. This means I can clear any task in Airflow, re-run it, and guarantee the result will be exactly the same as if it had run perfectly the first time.</p>

            <p><strong>How this works in practice:</strong></p>
            <ul>
                <li><strong>Airflow Tasks:</strong> Every task is templated using the execution date. When the ingestion task runs for <code>2025-12-22</code>, it doesn't just "append" data. It explicitly targets the partition for that specific date. If I re-run the task, it overwrites that specific slice of time. It is impossible to accidentally double-load data by clicking "Clear" in the UI.</li>
                <li><strong>dbt Transformations:</strong> dbt (data build tool) is the other half of this equation. Because dbt models are declarative (<code>SELECT</code> statements) rather than imperative (<code>INSERT/UPDATE</code> scripts), dbt handles the complexity of replacing tables or merging incremental data cleanly.</li>
            </ul>

            <p>This design choice drastically reduces the "Mean Time To Recovery." If a pipeline fails at 3:00 AM, I don't have to perform surgery on the database. I fix the upstream issue, clear the DAG, and go back to sleep. The system heals itself.</p>

            <h3>Looking Ahead: What happens when we need it faster?</h3>

            <p>The most common critique of this batch-based architecture is latency. "What if a client needs real-time Gammas?"</p>

            <p>If that requirement comes, a reactive architect might tear this all down to build a complex streaming solution. A <em>calm</em> architect evolves the foundation:</p>

            <ol>
                <li><strong>Ingest:</strong> Swap S3 batch loads for <strong>Snowpipe Streaming</strong>.</li>
                <li><strong>Transform:</strong> Swap hourly dbt jobs for <strong>Snowflake Dynamic Tables</strong>.</li>
                <li><strong>Result:</strong> Latency drops from 24 hours to 60 seconds, using largely the same SQL semantics and business rules.</li>
            </ol>

            <p>Calm engineering isn't about refusing to scale. It's about building a foundation strong enough to hold the entire market today, but flexible enough to evolve tomorrow.</p>

            <p>Check out the full 15-ticker dashboard live on the site: <a href="/projects">üêà catincloudlabs.com/projects</a></p>

            <div class="pro-tip">
                <h3>‚ö° Engineering Note: MWAA Dependency Hell</h3>
                <p class="muted">
                    Speaking of "dependency hell": if anyone else is currently fighting with Python library conflicts in MWAA, I‚Äôm happy to save you a weekend of debugging.
                </p>
                <p class="muted">
                    Here is the constraints file I built to keep the environment stable (MWAA 3.0.6 / Python 3.12). It took two days of trial and error to get this right. Feel free to steal it üò∏
                </p>
                
                <a href="/constraints/constraints-mwaa-3.0.6-py312-protobuf6.txt" class="file-link" download>
                   üìÑ Download Constraints File (MWAA 3.0.6 / Py3.12)
                </a>
                
                <p class="muted" style="font-size: 0.85rem; margin-top: 1rem;">
                    If you try it and it‚Äôs still not working for you, don't hesitate to reach out!
                </p>
            </div>

          </article>

        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container inner center">
      <small>¬© <span id="y"></span> CatInCloud Labs - DaveHasACat LLC</small>
      <div class="footer-links">
        <a href="/about">About</a> ¬∑
        <a href="/security">Security</a> ¬∑
        <a href="/privacy">Privacy</a> ¬∑
        <a href="/terms">Terms</a> ¬∑
        <a href="/contact#contact-form">Contact</a>
      </div>
    </div>
    <script src="/assets/js/footer-year-theme.js" defer></script>
  </footer>
</body>
</html>